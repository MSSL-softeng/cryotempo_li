<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.7.0"/>
    <title>clev2er API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><style>
    .pdoc .mermaid-pre {
        border: none;
        background: none;
    }
</style>
<script type="module" defer>
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";

    /* Re-invoke Mermaid when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => mermaid.run()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>
            <img src="https://www.homepages.ucl.ac.uk/~ucasamu/mssl_logo.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

            <h2>Contents</h2>
            <ul>
  <li><a href="#cryotempo-land-ice-l2-processor">CryoTEMPO Land Ice L2 Processor</a>
  <ul>
    <li><a href="#main-features">Main Features</a></li>
    <li><a href="#change-log">Change Log</a></li>
    <li><a href="#installation-of-the-framework">Installation of the Framework</a></li>
    <li><a href="#run-the-install-script">Run the Install Script</a></li>
    <li><a href="#regular-setup-and-activation">Regular Setup and Activation</a></li>
    <li><a href="#chain-controller">Chain Controller</a></li>
    <li><a href="#run-a-basic-test-chain">Run a basic test chain</a></li>
    <li><a href="#examples-of-cryotempo-processing-of-cryosat-2-l1b-files">Examples of CryoTEMPO processing of CryoSat-2 L1b files</a></li>
    <li><a href="#chain-components-and-configuration">Chain Components and Configuration</a></li>
    <li><a href="#developer-processes">Developer Processes</a></li>
    <li><a href="#configuration">Configuration</a></li>
    <li><a href="#developing-new-chains">Developing New Chains</a></li>
    <li><a href="#algorithm-and-finder-classes">Algorithm and Finder Classes</a></li>
    <li><a href="#logging">Logging</a></li>
    <li><a href="#breakpoint-files">Breakpoint Files</a></li>
    <li><a href="#developer-notes">Developer Notes</a></li>
  </ul></li>
</ul>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="clev2er/algorithms.html">algorithms</a></li>
                    <li><a href="clev2er/tools.html">tools</a></li>
                    <li><a href="clev2er/utils.html">utils</a></li>
            </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
clev2er    </h1>

                        <div class="docstring"><h1 id="cryotempo-land-ice-l2-processor">CryoTEMPO Land Ice L2 Processor</h1>

<p>A python algorithm framework, available from <a href="https://github.com/MSSL-softeng/cryotempo_li">https://github.com/MSSL-softeng/cryotempo_li</a> for
development of the <strong>ESA CryoTEMPO Land Ice L2 processor</strong>.</p>

<p>The framework is designed for (but not
restricted to) Level-1b to Level-2 processing of ESA radar altimetry mission data. The key features
of the framework are dynamically loaded algorithm classes (from XML or YML lists of algorithms)
and in-built support for multi-processing and a consistent automated development and testing
workflow. There are many run-time options in the chain controller command line tool.</p>

<p>The diagram below shows a simplified representation of the framework and its components.</p>

<p><img src="images/framework.jpg" alt="framework" title="framework" /></p>

<h2 id="main-features">Main Features</h2>

<ul>
<li>Command line chain controller tool : src/clev2er/tools/run_chain.py</li>
<li>input L1b file selection (single file, multiple files or dynamic algorithm selection)</li>
<li>dynamic algorithm loading from XML or YML list(s)
<ul>
<li>algorithms are classes of type Algorithm with configurable .init(), .process(), .finalize()
functions.</li>
<li>Algorithm.init() is called before any L1b file processing.</li>
<li>Algorithm.process() is called on every L1b file,</li>
<li>Algorithm.finalize() is called after all files have been processed.</li>
<li>Each algorithm has access to: L1b Dataset, shared working dict, config dict.</li>
<li>Algorithm/chain configuration by XML or YAML configuration files.</li>
<li>A shared python dictionary is used to pass algorithm outputs between algorithms in the chain.</li>
</ul></li>
<li>logging with standard warning, info, debug, error levels (+ multi-processing logging support)</li>
<li>optional multi-processing built in, configurable maximum number of processes used.</li>
<li>optional use of shared memory (for example for large DEMs and Masks) when using multi-processing.
This is an optional experimental feature that must be used with great care as it can result in
memory leaks (requiring a server reboot to free) if shared memory is not correctly closed.</li>
<li>algorithm timing (with MP support)</li>
<li>chain timing</li>
<li>support for breakpoint files (saved as NetCDF4 files)</li>
</ul>

<h2 id="change-log">Change Log</h2>

<p>This section details major changes to the framework (not individual chains):</p>

<table>
<thead>
<tr>
  <th>Date</th>
  <th>Change</th>
</tr>
</thead>
<tbody>
<tr>
  <td>15-Nov-23</td>
  <td>config file directory structure changed to config/chain_configs/<em>chainname</em>/</td>
</tr>
<tr>
  <td>15-Nov-23</td>
  <td>algorithm_lists file directory structure changed to now add directory /<em>chainname</em>/</td>
</tr>
<tr>
  <td>10-Nov-23</td>
  <td>breakpoint support added. See section on breakpoints below.</td>
</tr>
<tr>
  <td>May-Sep-24</td>
  <td>Development of Baseline-D evolution to the cryotempo chain</td>
</tr>
<tr>
  <td>20-Dec-24</td>
  <td>updated to use Python 3.12</td>
</tr>
<tr>
  <td>28-Dec-24</td>
  <td>new install process</td>
</tr>
</tbody>
</table>

<h2 id="installation-of-the-framework">Installation of the Framework</h2>

<p>Note that the framework installation has been tested on Linux and MacOS systems. Use on
other operating systems is possible but may require additional install steps, and is not yet
directly supported.</p>

<p>Make sure you have <em>git</em> (v2+) installed on your target system.</p>

<p>Clone the git public repository in to a suitable directory on your system.
This will create a directory called <strong>/cryotempo_li</strong> in your current directory.</p>

<p>with https:
<code>git clone https://github.com/MSSL-softeng/cryotempo_li.git</code></p>

<p>or with ssh:
<code>git clone git@github.com:MSSL-softeng/cryotempo_li.git</code></p>

<p>or with the GitHub CLI:
<code>gh repo clone MSSL-softeng/cryotempo_li</code></p>

<h2 id="run-the-install-script">Run the Install Script</h2>

<p>The provided install script (for macos/linux) does the following:</p>

<ul>
<li>check for availability of python 3.12.</li>
<li>if python 3.12 not available installs it within a local miniconda
environment.</li>
<li>installs <em>poetry</em> dependency manager</li>
<li>Using poetry installs all package dependencies in to a local
virtual environment</li>
<li>installs the <em>pre-commit</em> tool</li>
<li>installs pre-commit packages</li>
<li>creates <strong>ct_activate.sh</strong>, a script used to activate the CryoTEMPO
virtual environment and set environment variables.</li>
</ul>

<p>From the directory that you ran the git clone command, do the following:</p>

<pre><code>cd cryotempo_li
./install.sh
</code></pre>

<p><strong>Note</strong> that you may need to edit <strong>ct_activate.sh</strong> if the install
script reports that any paths pointed to by environment variables do not exist.</p>

<h2 id="regular-setup-and-activation">Regular Setup and Activation</h2>

<p>Whenever you use the CryoTEMPO software you need to activate
the virtual environment and setup required environment variables
within your current shell. The installation
process creates a script to do this for you. Run this each time you
start a new shell.</p>

<pre><code>cd cryotempo_li
source ./ct_activate.sh
</code></pre>

<h2 id="chain-controller">Chain Controller</h2>

<p>The framework's chain controller is a tool called <strong>run_chain.py</strong>.</p>

<p>You can find all <strong>run_chain.py</strong>'s command line options using:</p>

<pre><code>run_chain.py -h (or --help)
</code></pre>

<p>For further info, please see <code><a href="clev2er/tools.html">clev2er.tools</a></code></p>

<p><strong>Note</strong>: make sure you have activated the software (using <strong>source ct_activate.sh</strong>)
prior to running run_chain.py.</p>

<h2 id="run-a-basic-test-chain">Run a basic test chain</h2>

<p>The following command tests the  CLEV2ER
framework (within which the CryoTEMPO chain runs) running a separate test
chain which dynamically loads
2 template algorithms and runs them on a set of CryoSat L1b files.
This should run without any errors.</p>

<pre><code>run_chain.py -n testchain -d $CLEV2ER_BASE_DIR/testdata/cs2/l1bfiles
</code></pre>

<h2 id="examples-of-cryotempo-processing-of-cryosat-2-l1b-files">Examples of CryoTEMPO processing of CryoSat-2 L1b files</h2>

<p>Here are examples of running the main CryoTEMPO Baseline-D Land Ice
chain.</p>

<p>Process a single CS2 L1b file using the <strong>cryotempo</strong> chain:</p>

<pre><code>run_chain.py -n cryotempo -f $CPDATA_DIR/SATS/RA/CRY/L1B/SIN/2020/01/CS_LTA__SIR_SIN_1B_20200131T233512_20200131T233720_E001.nc
</code></pre>

<p>Process January 2020 using multi-processing mode, by using the
following command line options:</p>

<ul>
<li>-n cryotempo: selects the <strong>cryotempo</strong> chain</li>
<li>-b D -v 1 : uses baseline D001 config files</li>
<li>-y 2020 -m 1 : process all L1b files in Jan 2020</li>
<li>-mp -np 20 : use multi-processing mode, and split over 20 processes. You can
use a higher or lower number of processes depending upon the number of cores
on your system and available memory. For operational monthly processing at MSSL
we use 200-400 processes for multi-processing on 128-core servers with 512GB RAM.</li>
</ul>

<p>Note that the default location of the L1b files is in this case set by the chain
configuration file (which is set to use env variable $L1B_BASE_DIR, to a path which should
contain LRM,SIN/<YYYY>/<MM>/). L1B_BASE_DIR is set in the ct_activate.sh</p>

<pre><code>run_chain.py -n cryotempo -b D -v 1 -y 2020 -m 1 -mp -np 20
</code></pre>

<p>Process all of 2020 using multi-processing mode, by using the following
command line options:</p>

<pre><code>run_chain.py -n cryotempo -b D -v 1 -y 2020 -mp -np 20
</code></pre>

<p>It is recommended to run the above commands (which can take several hours to complete)
within a <strong>screen</strong> or <strong>tmux</strong> session or using <strong>nohup</strong> so that the process is not
killed when your current terminal times out.</p>

<pre><code>nohup run_chain.py -n cryotempo -b D -v 1 -y 2020 -mp -np 20 &gt; /tmp/output.log 2&gt;&amp;1
</code></pre>

<h2 id="chain-components-and-configuration">Chain Components and Configuration</h2>

<p>This section describes the location of the main chain components and chain
configuration files.</p>

<h3 id="algorithm-code">Algorithm Code</h3>

<p>Each algorithm in the chain is stored in a seperate Algorithm class file (alg_xxx.py) in
the <code>src/clev2er/algorithms/cryotempo/</code> directory.</p>

<p>Links to the algorithms at: <code><a href="clev2er/algorithms/cryotempo.html">clev2er.algorithms.cryotempo</a></code></p>

<h3 id="chain-configuration">Chain Configuration</h3>

<p>These contain the tunable parameters for each version of the chain, and
are located at:</p>

<p><code>config/chain_configs/cryotempo/cryotempo_D*NNN*.yml</code>, where <em>NNN</em> is the version number.
number (ie 001, 002).</p>

<h3 id="algorithm-lists">Algorithm Lists</h3>

<p>This contains the list and order of algorithms that are dynamically loaded:</p>

<p><code>config/algorithm_lists/cryotempo/cryotempo_D*NNN*.yml</code>, where <em>NNN</em> is the version number.
number (ie 001, 002).</p>

<h2 id="developer-processes">Developer Processes</h2>

<p>This section details additional installation requirements for developers who will develop/adapt
new chains or algorithms.</p>

<ul>
<li><p>create a new git branch (replace xxx with your initials, and my_new_feature
with a suitable name)</p>

<pre><code>git checkout -b xxx_my_new_feature
</code></pre></li>
<li><p>code your new feature and tests, committing regularly to your new branch</p>

<pre><code>git commit -a -m "commit message"
</code></pre></li>
<li><p>push your branch to GitHub for the first time. Subsequently you can
just do a <code>git push</code></p>

<pre><code>git push --set-upstream origin xxx_my_new_feature
</code></pre></li>
<li><p>create a pull request on GitHub for your branch</p></li>
<li><p>check that the GitHub actions tests show no errors in your pull request</p></li>
<li><p>repeat the above steps until you are happy with the feature branch</p></li>
<li><p>request a review on the GitHub pull request page</p></li>
<li><p>if the review passes the feature will be merged in to the master branch</p></li>
</ul>

<h2 id="configuration">Configuration</h2>

<p>Chains can be configured using XML or YAML configuration files and optional command line
options in the following order of increasing precedence:</p>

<ul>
<li>main config file: $CLEV2ER_BASE_DIR/config/main_config.xml [Must be XML]</li>
<li>chain specific config file:
$CLEV2ER_BASE_DIR/config/chain_configs/*chain_name<em>/</em>chain_name*_<em>BVVV</em>.yml or .xml, where
BVVV is the baseline character (A..Z) and version number (001,..)</li>
<li>command line options</li>
<li>command line additional config options using the --conf_opts</li>
</ul>

<p>The configurations are passed to
the chain's algorithms and finder classes, via a merged python dictionary, available
to the Algorithm classes as self.config.</p>

<h3 id="run-control-configuration">Run Control Configuration</h3>

<p>The default run control configuration file is <code>$CLEV2ER_BASE_DIR/config/main_config.xml</code></p>

<p>This contains general default settings for the chain controller. Each of these can
be overridden by the relevant command line options.</p>

<table>
<thead>
<tr>
  <th>Setting</th>
  <th>Options</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>use_multi_processing</td>
  <td>true or false</td>
  <td>if true multi-processing is used</td>
</tr>
<tr>
  <td>max_processes_for_multiprocessing</td>
  <td>int</td>
  <td>max number of processes to use for multi-processing</td>
</tr>
<tr>
  <td>use_shared_memory</td>
  <td>true or false</td>
  <td>if true allow use of shared memory. Experimental feature</td>
</tr>
<tr>
  <td>stop_on_error</td>
  <td>true or false</td>
  <td>stop chain on first error found, or log error and skip</td>
</tr>
</tbody>
</table>

<h3 id="chain-specific-configuration">Chain Specific Configuration</h3>

<p>The default configuration for your chain's algorithms and finder classes should be placed in
the chain specific config file:</p>

<p><code>$CLEV2ER_BASE_DIR/config/chain_configs/&lt;chain_name&gt;/&lt;chain_name&gt;_&lt;BVVV&gt;[.xml,or .yml]</code></p>

<p>where B is the baseline (major version) character A..Z, and VVV is the zero padded minor
version number.</p>

<p>Configuration files may be either XML(.xml) or YAML (.yml) format.</p>

<h4 id="formatting-rules-for-chain-configuration-files">Formatting Rules for Chain Configuration Files</h4>

<p>YAML or XML files can contain multi-level settings for key value pairs of boolean,
int, float or str.</p>

<ul>
<li>boolean values must be set to the string <strong>true</strong> or <strong>false</strong> (case insensitive)</li>
<li>environment variables are allowed within strings as $ENV_NAME or ${ENV_NAME} (and will be
evaluated)</li>
<li>YAML or XML files may have multiple levels (or sections)</li>
<li>XML files must have a top root level named <em>configuration</em>  wrapping the lower levels.
This is removed from the python config dictionary before being passed to the algorithms.</li>
<li>chain configuration files must have a <strong>log_files</strong> section (see <strong>required settings</strong>
below for the format) to provide locations of the log files.</li>
</ul>

<p>Example of sections from a 2 level config file in YML:</p>

<pre><code># some_key: str:  description
some_key: a string

section1:
    key1: 1
    key2: 1.5
    some_data_location: $MYDATA/dem.nc

section2:
    key: false
</code></pre>

<p>Example of sections from a 2 level config file in XML:</p>

<pre><code>&lt;?xml version="1.0"?&gt;

&lt;!-- configuration xml level required, but removed in python dict --&gt;
&lt;configuration&gt;

&lt;!--some_key: str:  description--&gt;
&lt;some_key&gt;a string&lt;/some_key&gt;

&lt;section1&gt;
   &lt;key1&gt;1&lt;/key1&gt;
   &lt;key2&gt;1.5&lt;/key2&gt;
   &lt;some_data_location&gt;$MYDATA/dem.nc&lt;/some_data_location&gt;
&lt;/section1&gt;

&lt;section2&gt;
   &lt;key&gt;false&lt;/key&gt;
&lt;/section2&gt;

&lt;/configuration&gt;

</code></pre>

<p>These settings are available within Algorithm classes as a python dictionary called
<strong>self.config</strong> as in the following examples:</p>

<pre><code>self.config['section1']['key1']
self.config['section1']['some_data_location']
self.config['some_key']
</code></pre>

<p>The config file will also be
merged with the main run control dictionary. Settings in the chain configuration
file will take precedence over the main run control dictionary (if they are identical), so
you can override any main config settings in the named chain config if you want.</p>

<h3 id="required-chain-configuration-settings">Required Chain Configuration Settings</h3>

<p>Each chain configuration file should contain sections to configure logging and breakpoints.
See the section on logging below for an explanation of the settings.</p>

<p>Here is a minimal configuration file (XML format)</p>

<pre><code>&lt;?xml version="1.0"?&gt;
&lt;!--chain: mychain configuration file--&gt;

&lt;configuration&gt; &lt;!-- note this level is removed in python dict --&gt;

&lt;!--Setup default locations to store breakpoint files--&gt;
&lt;breakpoint_files&gt;
    &lt;!-- set the default directory where breakpoint files are stored --&gt;
    &lt;default_dir&gt;/tmp&lt;/default_dir&gt;
&lt;/breakpoint_files&gt;

&lt;log_files&gt;
    &lt;append_year_month_to_logname&gt;false&lt;/append_year_month_to_logname&gt;

    &lt;!-- debug : str : path of the debug log file --&gt;
    &lt;debug&gt;/tmp/debug.log&lt;/debug&gt;

    &lt;!-- info : str : path of the info log file --&gt;
    &lt;info&gt;/tmp/info.log&lt;/info&gt;

    &lt;!-- errors : str : path of the errors log file --&gt;
    &lt;errors&gt;/tmp/errors.log&lt;/errors&gt;
&lt;/log_files&gt;

&lt;!-- add more levels and settings below here --&gt;

&lt;/configuration&gt;

</code></pre>

<p>The requirement for specific settings are set by the chain and it's algorithms.
An example of a chain configuration file can be found at:</p>

<p><code>$CLEV2ER_BASE_DIR/config/chain_configs/cryotempo/cryotempo_C001.yml</code></p>

<p>For testing purposes it is sometimes useful to modify configuration settings directly
from the command line. This can be done using the command line option --conf_opts which
can contain a comma separated list of section:key:value pairs.</p>

<p>An example of changing the value of the setting above would be:</p>

<p>--conf_opts resources:mydata:${MYDATA_DIR}/somedata2.nc</p>

<h2 id="developing-new-chains">Developing New Chains</h2>

<ol>
<li>Decide on a chain name. For example <strong>newchain</strong></li>
<li>Create $CLEV2ER_BASE_DIR/algorithms/<strong>newchain</strong>/ directory to store the new chain's algorithms.</li>
<li>Create $CLEV2ER_BASE_DIR/algorithms/<strong>newchain</strong>/tests to store the new chain's
algorithm unit tests (using tests formatted for pytest). At least one algorithm test file
should be created per algorithm, which should contain suitable test functions.</li>
<li>Create your algorithms by copying and renaming the algorithm class template
$CLEV2ER_BASE_DIR/algorithms/testchain/alg_template1.py in to your algorithm directory. Each
algorithm
should have a different file name of your choice. For example: alg_retrack.py, alg_geolocate.py.
You need to fill in the appropriate sections of the init(), process() and finalize() functions
for each algorithm (see section below for more details on using algorithm classes).</li>
<li>You must also create a test for each algorithm in
$CLEV2ER_BASE_DIR/algorithms/<strong>newchain</strong>/tests.
You should copy/adapt the test template
$CLEV2ER_BASE_DIR/algorithms/testchain/tests/test_alg_template1.py
for your new test.</li>
<li>Each algorithm and their unit tests must pass the static code checks (pylint, mypy, etc) which
are automatically run as git pre-commit hooks.</li>
<li>Create a first XML or YML configuration file for the chain in
$CLEV2ER_BASE_DIR/config/chain_configs/**newchain**/**newchain**_A001.yml. The configuration
file contains any settings or resource locations that are required by your algorithms, and
may include environment variables.</li>
<li>If required create one or more finder class files. These allow fine control of L1b file
selection from the command line (see section below for more details).</li>
<li>Create an algorithm list YML file in
$CLEV2ER_BASE_DIR/config/algorithm_lists/**newchain**/**newchain**_A001.yml.
You can copy the template
in $CLEV2ER_BASE_DIR/config/algorithm_lists/testchain/testchain_A001.yml</li>
<li>To test your chain on a single L1b file, you can use
<code>run_chain.py --name newchain -f /path/to/a/l1b_file</code>. There are many other options for
 running chains (see <code>run_chain.py -h</code>).</li>
</ol>

<h2 id="algorithm-and-finder-classes">Algorithm and Finder Classes</h2>

<p>This section discusses how to develop algorithms for your chain. There are two types
of algorithms, both of which are dynamically loaded at chain run-time.</p>

<ul>
<li>Main algorithms : standard chain algorithm classes</li>
<li>Finder algorithms : optional classes to manage input L1b file selection</li>
</ul>

<h3 id="algorithm-lists-2">Algorithm Lists</h3>

<p>Algorithms are dynamically loaded in a chain when (and in the order ) they are named in the chain's
algorithm list YAML or XML file:
$CLEV2ER_BASE_DIR/config/algorithm_lists/**chainname**/**chainname**.yml,.xml.
This has two sections (l1b_file_selectors, and algorithms) as shown in the example below:</p>

<p>YML version:</p>

<pre><code># List of L1b selector classes to call in order
l1b_file_selectors:
  - find_lrm  # find LRM mode files that match command line options
  - find_sin  # find SIN mode files that match command line options
# List of main algorithms to call in order
algorithms:
  - alg_identify_file # find and store basic l1b parameters
  - alg_skip_on_mode  # finds the instrument mode of L1b, skip SAR files
  #- alg_...
</code></pre>

<p>XML version:</p>

<p>The xml version requires an additional toplevel <code>&lt;algorithm_list&gt;</code> that wraps the other sections.
It also allows you to enable or disable individual algorithms within the list by setting the
values <em>Enable</em> or <em>Disable</em>, and to set breakpoints by setting the value to <em>BreakpointAfter</em>.</p>

<pre><code>&lt;?xml version="1.0"?&gt;

&lt;algorithm_list&gt;
    &lt;algorithms&gt;
        &lt;alg_identify_file&gt;Enable&lt;/alg_identify_file&gt;
        &lt;alg_skip_on_mode&gt;Enable&lt;/alg_skip_on_mode&gt;
        &lt;!-- ... more algorithms --&gt;
        &lt;alg_retrack&gt;BreakpointAfter&lt;/alg_retrack&gt;
    &lt;/algorithms&gt;

    &lt;l1b_file_selectors&gt;
        &lt;find_lrm&gt;Enable&lt;/find_lrm&gt;
        &lt;find_sin&gt;Enable&lt;/find_sin&gt;
    &lt;/l1b_file_selectors&gt;
&lt;/algorithm_list&gt;

</code></pre>

<h3 id="main-algorithms">Main Algorithms</h3>

<p>Each algorithm is implemented in a separate module located in</p>

<p><code>$CLEV2ER_BASE_DIR/src/clev2er/algorithms/&lt;chainname&gt;/&lt;alg_name&gt;.py</code></p>

<p>Each algorithm module should contain an Algorithm class, as per the algorithm
template in:</p>

<p><code>$CLEV2ER_BASE_DIR/src/clev2er/algorithms/testchain/alg_template1.py</code></p>

<p>Please copy this template for all algorithms.</p>

<p>Algorithm class modules have three main functions:</p>

<ul>
<li><strong>init()</strong> :  used for initializing/loading resources. Called once at the start of processing.</li>
<li><strong>process</strong>(l1b:Dataset,shared_dict:dict) : called for every L1b file. The results of the
processing may be saved in the shared_dict, so that it can be accessed by algorithms called
further down the chain. The L1b data for the current file being processed is passed to this
function in a netcdf4 Dataset as argument l1b.</li>
<li><strong>finalize</strong>() : called at the end of all processing to free resouces.</li>
</ul>

<p>All of the functions have access to the merged chain configuration dictionary <strong>self.config</strong>.</p>

<p>All logging must be done using <strong>self.log</strong>.info(), <strong>self.log</strong>.error(), <strong>self.log</strong>.debug().</p>

<h4 id="algorithmprocess-return-values">Algorithm.process() return values</h4>

<p>It is important to note that Algorithm.<strong>process()</strong> return values affect how the
chain operates. The .process() function returns (bool, str).</p>

<p>Return values must be set as follows:</p>

<ul>
<li>(<strong>True</strong>,"") when the processing has completed without errors and continuation to the
next algorithm in the chain (if available) is expected.</li>
<li>(<strong>False</strong>,"<strong>SKIP_OK</strong> any reason message") when the processing has found a valid reason for the
chain to skip any further processing of the L1b file. For example if it does not measure over the
target area. This will be logged as DEBUG message but is not an error. The chain will move to
processing the next L1b file.</li>
<li>(<strong>False</strong>,"some error message") : In this case the error message will be logged to the error log
and the file will be skipped. If <strong>config</strong>["chain"]["<strong>stop_on_error</strong>"] is False then the
chain will continue to the next L1b file. If <strong>config</strong>["chain"]["<strong>stop_on_error</strong>"] is True,
then the chain will stop.</li>
</ul>

<h3 id="filefinder-classes">FileFinder Classes</h3>

<p>FileFinder class modules provide more complex and tailored L1b input file selection
than would be possible with the standard <strong>run_chain.py</strong> command line options of :</p>

<ul>
<li>(<strong>--file path</strong>) : choose single L1b file</li>
<li>(<strong>--dir dir</strong>) : choose all L1b files in a flat directory</li>
</ul>

<p>FileFinder classes are only used as the file selection method if the --file and --dir
command line options are <strong>not</strong> used.</p>

<p>For example you may wish to select files using a specific search pattern, or from multiple
directories.</p>

<p>FileFinder classes are automatically initialized with :</p>

<ul>
<li><strong>self.config</strong> dict from the merged chain dict, any settings can be used for file selection</li>
<li><strong>self.months</strong> (from command line option --month, if used)</li>
<li><strong>self.years</strong> (from command line option --year, if used)</li>
</ul>

<p>FileFinder classes return a list of file paths through their .find_files() function.
Code needs to be added to the .find_files() function to generate the file list.</p>

<p>Any number of differently named FileFinder class modules can be specified in the algorithm list
file,
under the <strong>l1b_file_selectors:</strong> section. File lists are concatentated if more than one Finder
class is used.</p>

<p>An example of a FileFinder class module can be found in:</p>

<p><code>clev2er.algorithms.cryotempo.find_lrm.py</code></p>

<h2 id="logging">Logging</h2>

<p>Logging within the chain is performed using the python standard logging.Logger mechanism
but with some minor adaption to support multi-processing.</p>

<p>Within algorithm modules, logging should be performed using the in-class Logger
instance accessed using <strong>self.</strong>log :</p>

<ul>
<li>self.log.<strong>info</strong>('message') : to log informational messages</li>
<li>self.log.<strong>error</strong>('message') : to log error messages</li>
<li>self.log.<strong>debug</strong>('message') : to log messages for debugging</li>
</ul>

<p>Debugging messages are only produced/saved if the chain is run in debug mode (use
run_chain.py <strong>--debug</strong> command line option)</p>

<h3 id="log-file-locations">Log file Locations</h3>

<p>Info, error, and debug logs are stored in separate log files. The locations
of the log files are set in the chain configuration file in a section called
<strong>log_files</strong>. You can use environment variables in your log file paths.</p>

<pre><code># Default locations for log files
log_files:
  append_year_month_to_logname: true
  errors: ${CT_LOG_DIR}/errors.log
  info:   ${CT_LOG_DIR}/info.log
  debug:  ${CT_LOG_DIR}/debug.log
</code></pre>

<p>The <strong>append_year_month_to_logname</strong> setting is used if the chain is
run with the --year (and/or) --month command line args. Note that these
command line options are passed to the optional finder classes to generate a
list of L1b input files.</p>

<p>If these are used and the append_year_month_to_logname setting is <strong>true</strong>,
then the year and month are appended to the log file names as follows:</p>

<ul>
<li><em>logname</em>_<em>MMYYYY</em>.log : if both month and year are specified</li>
<li><em>logname</em>_<em>YYYY</em>.log : if only year is used</li>
</ul>

<h3 id="logging-when-using-multi-processing">Logging when using Multi-Processing</h3>

<p>When multi-processing mode is selected then logged messages are automatically passed
through a pipe to a temporary file (<em>logfilename</em>.mp). This will
contain an unordered list of messages from all processes, which is difficult
to read directly.</p>

<p>At the end of the chain run the multi-processing log outputs are automatically sorted
so that messages relating to each L1b file processing are collected together
in order. This is then merged in to the main log file.</p>

<h2 id="breakpoint-files">Breakpoint Files</h2>

<h6 id="breakpoints-can-be-set-after-any-algorithm-by">Breakpoints can be set after any Algorithm by:</h6>

<blockquote>
  <ul>
  <li>setting the <em>BreakpointAfter</em> value in the chain's Algorithm list, or</li>
  <li>using the run_chain.py command line argument **--breakpoint_after** *algorithm_name*</li>
  </ul>
</blockquote>

<h6 id="when-a-breakpoint-is-set">When a breakpoint is set:</h6>

<blockquote>
  <ul>
  <li>the chain will stop after the specified algorithm has completed for each input file.</li>
  <li>the contents of the chain's <em>shared_dict</em> will be saved as a NetCDF4 file in the
  <code>&lt;breakpoint_dir&gt;</code> as specified in the <em>breakpoints:default_dir</em> section in the chain
  configuration file.</li>
  <li>the NetCDF4 file will be named as <code>&lt;breakpoint_dir&gt;/&lt;l1b_file_name&gt;_bkp.nc</code></li>
  <li>if multiple L1b files are being processed through the chain, a breakpoint file
  will be created for each.</li>
  <li>single values or strings in the <em>shared_dict</em> will be included as global or group
  NetCDF attributes.</li>
  <li>if there are multiple levels in the <em>shared_dict</em> then a NetCDF group will be
  created for each level.</li>
  <li>multi-dimensional arrays (or numpy arrays) are supported up to dimension 3.</li>
  <li>NetCDF dimension variables will not be named with physical meaning (ie time),
  as this information can not be generically derived. Instead dimensions will be
  named dim1, dim2, etc.</li>
  <li>all variables with the same dimension will share a common NetCDF dimension (ie dim1, etc)</li>
  </ul>
</blockquote>

<h2 id="developer-notes">Developer Notes</h2>

<h3 id="code-checks-before-committing">Code checks before committing</h3>

<p>It is recommended to run pre-commit before a <code>git commit</code>. This runs the static
code analysis tests (isort, pylint, ruff, mypy,.. ) on your code and shows you any
failures before you commit. The same tests are also run when you commit (and must pass).</p>

<p><code>precommit run --all</code></p>

<h3 id="automatic-documentation">Automatic Documentation</h3>

<p>This user manual is hosted on GitHub pages (<a href="https://mssl-softeng.github.io/clev2er">https://mssl-softeng.github.io/clev2er</a>)</p>

<p>Content is created from doctrings
(optionally containing Markdown: <a href="https://www.markdownguide.org/basic-syntax/#code">https://www.markdownguide.org/basic-syntax/#code</a> )
in the code,
using the <em>pdoc</em> package : <a href="https://pdoc.dev">https://pdoc.dev</a></p>

<p>Diagrams are implemented using mermaid: <a href="https://mermaid.js.org">https://mermaid.js.org</a></p>

<p>The site is locally built in <code>$CLEV2ER_BASE_DIR/docs</code>, using a pre-commit hook
(hook id: pdocs_build).
Hooks are configured in <code>$CLEV2ER_BASE_DIR/.pre-commit-config.yaml</code></p>

<p>The hook calls the script <code>$CLEV2ER_BASE_DIR/pdocs_build.sh</code> to build the site
whenever a <code>git commit</code> is run.</p>

<p>When a <code>git push</code> is run, GitHub automatically extracts the site from the
docs directory and publishes it.</p>

<p>The front page of the site (ie this page) is located in the doctring within
<code>$CLEV2ER_BASE_DIR/src/clev2er/__init__.py</code>.</p>

<p>The docstring within <code>__init__.py</code> of each package directory should provide
markdown to describe the directories beneath it.</p>
</div>

                        <input id="mod-clev2er-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-clev2er-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd"># CryoTEMPO Land Ice L2 Processor</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">A python algorithm framework, available from https://github.com/MSSL-softeng/cryotempo_li for</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">development of the **ESA CryoTEMPO Land Ice L2 processor**.</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">The framework is designed for (but not</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">restricted to) Level-1b to Level-2 processing of ESA radar altimetry mission data. The key features</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">of the framework are dynamically loaded algorithm classes (from XML or YML lists of algorithms)</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">and in-built support for multi-processing and a consistent automated development and testing</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">workflow. There are many run-time options in the chain controller command line tool.</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">The diagram below shows a simplified representation of the framework and its components.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">![framework](images/framework.jpg &quot;framework&quot;)</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">## Main Features</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">* Command line chain controller tool : src/clev2er/tools/run_chain.py</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">* input L1b file selection (single file, multiple files or dynamic algorithm selection)</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">* dynamic algorithm loading from XML or YML list(s)</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">  * algorithms are classes of type Algorithm with configurable .init(), .process(), .finalize()</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">    functions.</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">  * Algorithm.init() is called before any L1b file processing.</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">  * Algorithm.process() is called on every L1b file,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">  * Algorithm.finalize() is called after all files have been processed.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">  * Each algorithm has access to: L1b Dataset, shared working dict, config dict.</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">  * Algorithm/chain configuration by XML or YAML configuration files.</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">  * A shared python dictionary is used to pass algorithm outputs between algorithms in the chain.</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">* logging with standard warning, info, debug, error levels (+ multi-processing logging support)</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">* optional multi-processing built in, configurable maximum number of processes used.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">* optional use of shared memory (for example for large DEMs and Masks) when using multi-processing.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">This is an optional experimental feature that must be used with great care as it can result in</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">memory leaks (requiring a server reboot to free) if shared memory is not correctly closed.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">* algorithm timing (with MP support)</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">* chain timing</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">* support for breakpoint files (saved as NetCDF4 files)</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">## Change Log</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">This section details major changes to the framework (not individual chains):</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">| Date | Change |</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">| ------- | ------- |</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">| 15-Nov-23 | config file directory structure changed to config/chain_configs/*chainname*/|</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">| 15-Nov-23 | algorithm_lists file directory structure changed to now add directory /*chainname*/|</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">| 10-Nov-23 | breakpoint support added. See section on breakpoints below. |</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">| May-Sep-24 | Development of Baseline-D evolution to the cryotempo chain|</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">| 20-Dec-24 | updated to use Python 3.12 |</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">| 28-Dec-24 | new install process |</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">## Installation of the Framework</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">Note that the framework installation has been tested on Linux and MacOS systems. Use on</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">other operating systems is possible but may require additional install steps, and is not yet</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">directly supported.</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">Make sure you have *git* (v2+) installed on your target system.</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">Clone the git public repository in to a suitable directory on your system.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">This will create a directory called **/cryotempo_li** in your current directory.</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">with https:</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">`git clone https://github.com/MSSL-softeng/cryotempo_li.git`</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">or with ssh:</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">`git clone git@github.com:MSSL-softeng/cryotempo_li.git`</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">or with the GitHub CLI:</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">`gh repo clone MSSL-softeng/cryotempo_li`</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">## Run the Install Script</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">The provided install script (for macos/linux) does the following:</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">- check for availability of python 3.12.</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">- if python 3.12 not available installs it within a local miniconda</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">  environment.</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">- installs *poetry* dependency manager</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">- Using poetry installs all package dependencies in to a local</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">  virtual environment</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">- installs the *pre-commit* tool</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">- installs pre-commit packages</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">- creates **ct_activate.sh**, a script used to activate the CryoTEMPO</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">  virtual environment and set environment variables.</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">From the directory that you ran the git clone command, do the following:</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">```</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">cd cryotempo_li</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">./install.sh</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">```</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">**Note** that you may need to edit **ct_activate.sh** if the install</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">script reports that any paths pointed to by environment variables do not exist.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">## Regular Setup and Activation</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">Whenever you use the CryoTEMPO software you need to activate</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">the virtual environment and setup required environment variables</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">within your current shell. The installation</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">process creates a script to do this for you. Run this each time you</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">start a new shell.</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">```</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">cd cryotempo_li</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">source ./ct_activate.sh</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">```</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">## Chain Controller</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">The framework&#39;s chain controller is a tool called **run_chain.py**.</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">You can find all **run_chain.py**&#39;s command line options using:</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">```</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">run_chain.py -h (or --help)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">```</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">For further info, please see `clev2er.tools`</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">**Note**: make sure you have activated the software (using **source ct_activate.sh**)</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">prior to running run_chain.py.</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">## Run a basic test chain</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">The following command tests the  CLEV2ER</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">framework (within which the CryoTEMPO chain runs) running a separate test</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">chain which dynamically loads</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">2 template algorithms and runs them on a set of CryoSat L1b files.</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">This should run without any errors.</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">```</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">run_chain.py -n testchain -d $CLEV2ER_BASE_DIR/testdata/cs2/l1bfiles</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">```</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">## Examples of CryoTEMPO processing of CryoSat-2 L1b files</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">Here are examples of running the main CryoTEMPO Baseline-D Land Ice</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">chain.</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">Process a single CS2 L1b file using the **cryotempo** chain:</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">```</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">run_chain.py -n cryotempo -f \</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">$CPDATA_DIR/SATS/RA/CRY/L1B/SIN/2020/01/CS_LTA__SIR_SIN_1B_20200131T233512_20200131T233720_E001.nc</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">```</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">Process January 2020 using multi-processing mode, by using the</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">following command line options:</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">-  -n cryotempo: selects the **cryotempo** chain</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">-  -b D -v 1 : uses baseline D001 config files</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">-  -y 2020 -m 1 : process all L1b files in Jan 2020</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">-  -mp -np 20 : use multi-processing mode, and split over 20 processes. You can</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">   use a higher or lower number of processes depending upon the number of cores</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">   on your system and available memory. For operational monthly processing at MSSL</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">   we use 200-400 processes for multi-processing on 128-core servers with 512GB RAM.</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">Note that the default location of the L1b files is in this case set by the chain</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">configuration file (which is set to use env variable $L1B_BASE_DIR, to a path which should</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">contain LRM,SIN/&lt;YYYY&gt;/&lt;MM&gt;/). L1B_BASE_DIR is set in the ct_activate.sh</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">```</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">run_chain.py -n cryotempo -b D -v 1 -y 2020 -m 1 -mp -np 20</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">```</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">Process all of 2020 using multi-processing mode, by using the following</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">command line options:</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">```</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">run_chain.py -n cryotempo -b D -v 1 -y 2020 -mp -np 20</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">```</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">It is recommended to run the above commands (which can take several hours to complete)</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">within a **screen** or **tmux** session or using **nohup** so that the process is not</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">killed when your current terminal times out.</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">```</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">nohup run_chain.py -n cryotempo -b D -v 1 -y 2020 -mp -np 20 &gt; /tmp/output.log 2&gt;&amp;1</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">```</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">## Chain Components and Configuration</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">This section describes the location of the main chain components and chain</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">configuration files.</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="sd">### Algorithm Code</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">Each algorithm in the chain is stored in a seperate Algorithm class file (alg_xxx.py) in</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">the `src/clev2er/algorithms/cryotempo/` directory.</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">Links to the algorithms at: `clev2er.algorithms.cryotempo`</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">### Chain Configuration</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">These contain the tunable parameters for each version of the chain, and</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">are located at:</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">`config/chain_configs/cryotempo/cryotempo_D*NNN*.yml`, where *NNN* is the version number.</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">number (ie 001, 002).</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">### Algorithm Lists</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">This contains the list and order of algorithms that are dynamically loaded:</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">`config/algorithm_lists/cryotempo/cryotempo_D*NNN*.yml`, where *NNN* is the version number.</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">number (ie 001, 002).</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">## Developer Processes</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">This section details additional installation requirements for developers who will develop/adapt</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">new chains or algorithms.</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">- create a new git branch (replace xxx with your initials, and my_new_feature</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">  with a suitable name)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">  ```</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">  git checkout -b xxx_my_new_feature</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">  ```</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">- code your new feature and tests, committing regularly to your new branch</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">  ```</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">  git commit -a -m &quot;commit message&quot;</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">  ```</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">- push your branch to GitHub for the first time. Subsequently you can</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">  just do a `git push`</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">  ```</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">  git push --set-upstream origin xxx_my_new_feature</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">  ```</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">- create a pull request on GitHub for your branch</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">- check that the GitHub actions tests show no errors in your pull request</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">- repeat the above steps until you are happy with the feature branch</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">- request a review on the GitHub pull request page</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">- if the review passes the feature will be merged in to the master branch</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">## Configuration</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">Chains can be configured using XML or YAML configuration files and optional command line</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">options in the following order of increasing precedence:</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">- main config file: $CLEV2ER_BASE_DIR/config/main_config.xml [Must be XML]</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">- chain specific config file:</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">  $CLEV2ER_BASE_DIR/config/chain_configs/*chain_name*/*chain_name*_*BVVV*.yml or .xml, where</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">  BVVV is the baseline character (A..Z) and version number (001,..)</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">- command line options</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">- command line additional config options using the --conf_opts</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">The configurations are passed to</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">the chain&#39;s algorithms and finder classes, via a merged python dictionary, available</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">to the Algorithm classes as self.config.</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">### Run Control Configuration</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">The default run control configuration file is `$CLEV2ER_BASE_DIR/config/main_config.xml`</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="sd">This contains general default settings for the chain controller. Each of these can</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="sd">be overridden by the relevant command line options.</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">| Setting | Options | Description |</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">| ------- | ------- | ----------- |</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">| use_multi_processing | true or false | if true multi-processing is used |</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">| max_processes_for_multiprocessing | int | max number of processes to use for multi-processing |</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">| use_shared_memory | true or false | if true allow use of shared memory. Experimental feature |</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">| stop_on_error | true or false | stop chain on first error found, or log error and skip |</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">### Chain Specific Configuration</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">The default configuration for your chain&#39;s algorithms and finder classes should be placed in</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">the chain specific config file:</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">`$CLEV2ER_BASE_DIR/config/chain_configs/&lt;chain_name&gt;/&lt;chain_name&gt;_&lt;BVVV&gt;[.xml,or .yml]`</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">where B is the baseline (major version) character A..Z, and VVV is the zero padded minor</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">version number.</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">Configuration files may be either XML(.xml) or YAML (.yml) format.</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">#### Formatting Rules for Chain Configuration Files</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">YAML or XML files can contain multi-level settings for key value pairs of boolean,</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">int, float or str.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">- boolean values must be set to the string **true** or **false** (case insensitive)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">- environment variables are allowed within strings as $ENV_NAME or ${ENV_NAME} (and will be</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">  evaluated)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">- YAML or XML files may have multiple levels (or sections)</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">- XML files must have a top root level named *configuration*  wrapping the lower levels.</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">  This is removed from the python config dictionary before being passed to the algorithms.</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">- chain configuration files must have a **log_files** section (see **required settings**</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">  below for the format) to provide locations of the log files.</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">Example of sections from a 2 level config file in YML:</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">```</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd"># some_key: str:  description</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">some_key: a string</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">section1:</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">    key1: 1</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">    key2: 1.5</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">    some_data_location: $MYDATA/dem.nc</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">section2:</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">    key: false</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">```</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">Example of sections from a 2 level config file in XML:</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">```</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">&lt;!-- configuration xml level required, but removed in python dict --&gt;</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">&lt;configuration&gt;</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">&lt;!--some_key: str:  description--&gt;</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">&lt;some_key&gt;a string&lt;/some_key&gt;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">&lt;section1&gt;</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">   &lt;key1&gt;1&lt;/key1&gt;</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">   &lt;key2&gt;1.5&lt;/key2&gt;</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">   &lt;some_data_location&gt;$MYDATA/dem.nc&lt;/some_data_location&gt;</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">&lt;/section1&gt;</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">&lt;section2&gt;</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">   &lt;key&gt;false&lt;/key&gt;</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">&lt;/section2&gt;</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">&lt;/configuration&gt;</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">```</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">These settings are available within Algorithm classes as a python dictionary called</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">**self.config** as in the following examples:</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">```</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">self.config[&#39;section1&#39;][&#39;key1&#39;]</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">self.config[&#39;section1&#39;][&#39;some_data_location&#39;]</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">self.config[&#39;some_key&#39;]</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">```</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">The config file will also be</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">merged with the main run control dictionary. Settings in the chain configuration</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">file will take precedence over the main run control dictionary (if they are identical), so</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">you can override any main config settings in the named chain config if you want.</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">### Required Chain Configuration Settings</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="sd">Each chain configuration file should contain sections to configure logging and breakpoints.</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a><span class="sd">See the section on logging below for an explanation of the settings.</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">Here is a minimal configuration file (XML format)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">```</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">&lt;!--chain: mychain configuration file--&gt;</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">&lt;configuration&gt; &lt;!-- note this level is removed in python dict --&gt;</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">&lt;!--Setup default locations to store breakpoint files--&gt;</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a><span class="sd">&lt;breakpoint_files&gt;</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">    &lt;!-- set the default directory where breakpoint files are stored --&gt;</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">    &lt;default_dir&gt;/tmp&lt;/default_dir&gt;</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="sd">&lt;/breakpoint_files&gt;</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">&lt;log_files&gt;</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="sd">    &lt;append_year_month_to_logname&gt;false&lt;/append_year_month_to_logname&gt;</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">    &lt;!-- debug : str : path of the debug log file --&gt;</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">    &lt;debug&gt;/tmp/debug.log&lt;/debug&gt;</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">    &lt;!-- info : str : path of the info log file --&gt;</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">    &lt;info&gt;/tmp/info.log&lt;/info&gt;</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">    &lt;!-- errors : str : path of the errors log file --&gt;</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">    &lt;errors&gt;/tmp/errors.log&lt;/errors&gt;</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">&lt;/log_files&gt;</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">&lt;!-- add more levels and settings below here --&gt;</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">&lt;/configuration&gt;</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">```</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">The requirement for specific settings are set by the chain and it&#39;s algorithms.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">An example of a chain configuration file can be found at:</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">`$CLEV2ER_BASE_DIR/config/chain_configs/cryotempo/cryotempo_C001.yml`</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">For testing purposes it is sometimes useful to modify configuration settings directly</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">from the command line. This can be done using the command line option --conf_opts which</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">can contain a comma separated list of section:key:value pairs.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">An example of changing the value of the setting above would be:</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">--conf_opts resources:mydata:${MYDATA_DIR}/somedata2.nc</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">## Developing New Chains</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">1. Decide on a chain name. For example **newchain**</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">2. Create $CLEV2ER_BASE_DIR/algorithms/**newchain**/ directory to store the new chain&#39;s algorithms.</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">3. Create $CLEV2ER_BASE_DIR/algorithms/**newchain**/tests to store the new chain&#39;s</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">   algorithm unit tests (using tests formatted for pytest). At least one algorithm test file</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">   should be created per algorithm, which should contain suitable test functions.</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">4. Create your algorithms by copying and renaming the algorithm class template</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">   $CLEV2ER_BASE_DIR/algorithms/testchain/alg_template1.py in to your algorithm directory. Each</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="sd">   algorithm</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="sd">   should have a different file name of your choice. For example: alg_retrack.py, alg_geolocate.py.</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">   You need to fill in the appropriate sections of the init(), process() and finalize() functions</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">   for each algorithm (see section below for more details on using algorithm classes).</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">5. You must also create a test for each algorithm in</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">   $CLEV2ER_BASE_DIR/algorithms/**newchain**/tests.</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">   You should copy/adapt the test template</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">   $CLEV2ER_BASE_DIR/algorithms/testchain/tests/test_alg_template1.py</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">   for your new test.</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">6. Each algorithm and their unit tests must pass the static code checks (pylint, mypy, etc) which</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">   are automatically run as git pre-commit hooks.</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">7. Create a first XML or YML configuration file for the chain in</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">   $CLEV2ER_BASE_DIR/config/chain_configs/**newchain**/**newchain**_A001.yml. The configuration</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">   file contains any settings or resource locations that are required by your algorithms, and</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="sd">   may include environment variables.</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="sd">8. If required create one or more finder class files. These allow fine control of L1b file</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="sd">   selection from the command line (see section below for more details).</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a><span class="sd">9. Create an algorithm list YML file in</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="sd">   $CLEV2ER_BASE_DIR/config/algorithm_lists/**newchain**/**newchain**_A001.yml.</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="sd">   You can copy the template</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">   in $CLEV2ER_BASE_DIR/config/algorithm_lists/testchain/testchain_A001.yml</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">10. To test your chain on a single L1b file, you can use</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a><span class="sd">   `run_chain.py --name newchain -f /path/to/a/l1b_file`. There are many other options for</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="sd">    running chains (see `run_chain.py -h`).</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a><span class="sd">## Algorithm and Finder Classes</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="sd">This section discusses how to develop algorithms for your chain. There are two types</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">of algorithms, both of which are dynamically loaded at chain run-time.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">- Main algorithms : standard chain algorithm classes</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">- Finder algorithms : optional classes to manage input L1b file selection</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">### Algorithm Lists</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">Algorithms are dynamically loaded in a chain when (and in the order ) they are named in the chain&#39;s</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">algorithm list YAML or XML file:</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">$CLEV2ER_BASE_DIR/config/algorithm_lists/**chainname**/**chainname**.yml,.xml.</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">This has two sections (l1b_file_selectors, and algorithms) as shown in the example below:</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">YML version:</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">```</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd"># List of L1b selector classes to call in order</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">l1b_file_selectors:</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">  - find_lrm  # find LRM mode files that match command line options</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">  - find_sin  # find SIN mode files that match command line options</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd"># List of main algorithms to call in order</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">algorithms:</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">  - alg_identify_file # find and store basic l1b parameters</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">  - alg_skip_on_mode  # finds the instrument mode of L1b, skip SAR files</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">  #- alg_...</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">```</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="sd">XML version:</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="sd">The xml version requires an additional toplevel `&lt;algorithm_list&gt;` that wraps the other sections.</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a><span class="sd">It also allows you to enable or disable individual algorithms within the list by setting the</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="sd">values *Enable* or *Disable*, and to set breakpoints by setting the value to *BreakpointAfter*.</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="sd">```</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="sd">&lt;algorithm_list&gt;</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a><span class="sd">    &lt;algorithms&gt;</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a><span class="sd">        &lt;alg_identify_file&gt;Enable&lt;/alg_identify_file&gt;</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="sd">        &lt;alg_skip_on_mode&gt;Enable&lt;/alg_skip_on_mode&gt;</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">        &lt;!-- ... more algorithms --&gt;</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="sd">        &lt;alg_retrack&gt;BreakpointAfter&lt;/alg_retrack&gt;</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">    &lt;/algorithms&gt;</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">    &lt;l1b_file_selectors&gt;</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">        &lt;find_lrm&gt;Enable&lt;/find_lrm&gt;</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="sd">        &lt;find_sin&gt;Enable&lt;/find_sin&gt;</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">    &lt;/l1b_file_selectors&gt;</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">&lt;/algorithm_list&gt;</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">```</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">### Main Algorithms</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">Each algorithm is implemented in a separate module located in</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a><span class="sd">`$CLEV2ER_BASE_DIR/src/clev2er/algorithms/&lt;chainname&gt;/&lt;alg_name&gt;.py`</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="sd">Each algorithm module should contain an Algorithm class, as per the algorithm</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="sd">template in:</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">`$CLEV2ER_BASE_DIR/src/clev2er/algorithms/testchain/alg_template1.py`</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a><span class="sd">Please copy this template for all algorithms.</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a><span class="sd">Algorithm class modules have three main functions:</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a><span class="sd">- **init()** :  used for initializing/loading resources. Called once at the start of processing.</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="sd">- **process**(l1b:Dataset,shared_dict:dict) : called for every L1b file. The results of the</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a><span class="sd">  processing may be saved in the shared_dict, so that it can be accessed by algorithms called</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="sd">  further down the chain. The L1b data for the current file being processed is passed to this</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">  function in a netcdf4 Dataset as argument l1b.</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">- **finalize**() : called at the end of all processing to free resouces.</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">All of the functions have access to the merged chain configuration dictionary **self.config**.</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="sd">All logging must be done using **self.log**.info(), **self.log**.error(), **self.log**.debug().</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="sd">#### Algorithm.process() return values</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">It is important to note that Algorithm.**process()** return values affect how the</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="sd">chain operates. The .process() function returns (bool, str).</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">Return values must be set as follows:</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">- (**True**,&quot;&quot;) when the processing has completed without errors and continuation to the</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">  next algorithm in the chain (if available) is expected.</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a><span class="sd">- (**False**,&quot;**SKIP_OK** any reason message&quot;) when the processing has found a valid reason for the</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">  chain to skip any further processing of the L1b file. For example if it does not measure over the</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="sd">  target area. This will be logged as DEBUG message but is not an error. The chain will move to</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">  processing the next L1b file.</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a><span class="sd">- (**False**,&quot;some error message&quot;) : In this case the error message will be logged to the error log</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="sd">  and the file will be skipped. If **config**[&quot;chain&quot;][&quot;**stop_on_error**&quot;] is False then the</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a><span class="sd">  chain will continue to the next L1b file. If **config**[&quot;chain&quot;][&quot;**stop_on_error**&quot;] is True,</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a><span class="sd">  then the chain will stop.</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a><span class="sd">### FileFinder Classes</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a><span class="sd">FileFinder class modules provide more complex and tailored L1b input file selection</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a><span class="sd">than would be possible with the standard **run_chain.py** command line options of :</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a><span class="sd">- (**--file path**) : choose single L1b file</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a><span class="sd">- (**--dir dir**) : choose all L1b files in a flat directory</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a><span class="sd">FileFinder classes are only used as the file selection method if the --file and --dir</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a><span class="sd">command line options are **not** used.</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a><span class="sd">For example you may wish to select files using a specific search pattern, or from multiple</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a><span class="sd">directories.</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a><span class="sd">FileFinder classes are automatically initialized with :</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a><span class="sd">- **self.config** dict from the merged chain dict, any settings can be used for file selection</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a><span class="sd">- **self.months** (from command line option --month, if used)</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a><span class="sd">- **self.years** (from command line option --year, if used)</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a><span class="sd">FileFinder classes return a list of file paths through their .find_files() function.</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a><span class="sd">Code needs to be added to the .find_files() function to generate the file list.</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a><span class="sd">Any number of differently named FileFinder class modules can be specified in the algorithm list</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a><span class="sd">file,</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a><span class="sd">under the **l1b_file_selectors:** section. File lists are concatentated if more than one Finder</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a><span class="sd">class is used.</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a><span class="sd">An example of a FileFinder class module can be found in:</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a><span class="sd">`clev2er.algorithms.cryotempo.find_lrm.py`</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a><span class="sd">## Logging</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a><span class="sd">Logging within the chain is performed using the python standard logging.Logger mechanism</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a><span class="sd">but with some minor adaption to support multi-processing.</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a><span class="sd">Within algorithm modules, logging should be performed using the in-class Logger</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a><span class="sd">instance accessed using **self.**log :</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a><span class="sd">- self.log.**info**(&#39;message&#39;) : to log informational messages</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a><span class="sd">- self.log.**error**(&#39;message&#39;) : to log error messages</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a><span class="sd">- self.log.**debug**(&#39;message&#39;) : to log messages for debugging</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a><span class="sd">Debugging messages are only produced/saved if the chain is run in debug mode (use</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a><span class="sd">run_chain.py **--debug** command line option)</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a><span class="sd">### Log file Locations</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a><span class="sd">Info, error, and debug logs are stored in separate log files. The locations</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a><span class="sd">of the log files are set in the chain configuration file in a section called</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a><span class="sd">**log_files**. You can use environment variables in your log file paths.</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a><span class="sd">```</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a><span class="sd"># Default locations for log files</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a><span class="sd">log_files:</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a><span class="sd">  append_year_month_to_logname: true</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a><span class="sd">  errors: ${CT_LOG_DIR}/errors.log</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a><span class="sd">  info:   ${CT_LOG_DIR}/info.log</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a><span class="sd">  debug:  ${CT_LOG_DIR}/debug.log</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a><span class="sd">```</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a><span class="sd">The **append_year_month_to_logname** setting is used if the chain is</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a><span class="sd">run with the --year (and/or) --month command line args. Note that these</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a><span class="sd">command line options are passed to the optional finder classes to generate a</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a><span class="sd">list of L1b input files.</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="sd">If these are used and the append_year_month_to_logname setting is **true**,</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a><span class="sd">then the year and month are appended to the log file names as follows:</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a><span class="sd">- *logname*_*MMYYYY*.log : if both month and year are specified</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a><span class="sd">- *logname*_*YYYY*.log : if only year is used</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a><span class="sd">### Logging when using Multi-Processing</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a><span class="sd">When multi-processing mode is selected then logged messages are automatically passed</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a><span class="sd">through a pipe to a temporary file (*logfilename*.mp). This will</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a><span class="sd">contain an unordered list of messages from all processes, which is difficult</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a><span class="sd">to read directly.</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a><span class="sd">At the end of the chain run the multi-processing log outputs are automatically sorted</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a><span class="sd">so that messages relating to each L1b file processing are collected together</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a><span class="sd">in order. This is then merged in to the main log file.</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a><span class="sd">## Breakpoint Files</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a><span class="sd">Breakpoints can be set after any Algorithm by:</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a><span class="sd">  - setting the *BreakpointAfter* value in the chain&#39;s Algorithm list, or</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a><span class="sd">  - using the run_chain.py command line argument **--breakpoint_after** *algorithm_name*</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a><span class="sd">When a breakpoint is set:</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a><span class="sd">  - the chain will stop after the specified algorithm has completed for each input file.</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a><span class="sd">  - the contents of the chain&#39;s *shared_dict* will be saved as a NetCDF4 file in the</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a><span class="sd">    ```&lt;breakpoint_dir&gt;``` as specified in the *breakpoints:default_dir* section in the chain</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a><span class="sd">    configuration file.</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a><span class="sd">  - the NetCDF4 file will be named as ```&lt;breakpoint_dir&gt;/&lt;l1b_file_name&gt;_bkp.nc```</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a><span class="sd">  - if multiple L1b files are being processed through the chain, a breakpoint file</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a><span class="sd">    will be created for each.</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a><span class="sd">  - single values or strings in the *shared_dict* will be included as global or group</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a><span class="sd">    NetCDF attributes.</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a><span class="sd">  - if there are multiple levels in the *shared_dict* then a NetCDF group will be</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a><span class="sd">    created for each level.</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a><span class="sd">  - multi-dimensional arrays (or numpy arrays) are supported up to dimension 3.</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a><span class="sd">  - NetCDF dimension variables will not be named with physical meaning (ie time),</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a><span class="sd">    as this information can not be generically derived. Instead dimensions will be</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a><span class="sd">    named dim1, dim2, etc.</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a><span class="sd">  - all variables with the same dimension will share a common NetCDF dimension (ie dim1, etc)</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a><span class="sd">## Developer Notes</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a><span class="sd">### Code checks before committing</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a><span class="sd">It is recommended to run pre-commit before a `git commit`. This runs the static</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a><span class="sd">code analysis tests (isort, pylint, ruff, mypy,.. ) on your code and shows you any</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a><span class="sd">failures before you commit. The same tests are also run when you commit (and must pass).</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a><span class="sd">`precommit run --all`</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a><span class="sd">### Automatic Documentation</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a><span class="sd">This user manual is hosted on GitHub pages (https://mssl-softeng.github.io/clev2er)</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a><span class="sd">Content is created from doctrings</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a><span class="sd">(optionally containing Markdown: https://www.markdownguide.org/basic-syntax/#code )</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a><span class="sd">in the code,</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a><span class="sd">using the *pdoc* package : https://pdoc.dev</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a><span class="sd">Diagrams are implemented using mermaid: https://mermaid.js.org</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a><span class="sd">The site is locally built in `$CLEV2ER_BASE_DIR/docs`, using a pre-commit hook</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a><span class="sd">(hook id: pdocs_build).</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a><span class="sd">Hooks are configured in `$CLEV2ER_BASE_DIR/.pre-commit-config.yaml`</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a><span class="sd">The hook calls the script `$CLEV2ER_BASE_DIR/pdocs_build.sh` to build the site</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a><span class="sd">whenever a `git commit` is run.</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a><span class="sd">When a `git push` is run, GitHub automatically extracts the site from the</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a><span class="sd">docs directory and publishes it.</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a><span class="sd">The front page of the site (ie this page) is located in the doctring within</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a><span class="sd">`$CLEV2ER_BASE_DIR/src/clev2er/__init__.py`.</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a><span class="sd">The docstring within `__init__.py` of each package directory should provide</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a><span class="sd">markdown to describe the directories beneath it.</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a><span class="sd">&quot;&quot;&quot;</span>
</span></pre></div>


            </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>